{% extends 'base.html' %}
{% block content %}

{% if 'User' in session %}
    {% if session['User'] == userid %}

        <div id="template-input" style="display: none;">
         <!-- This is the ingredient prototype that will duplicate when the user clicks on the "Add another ingredient" button -->
             <div>
                 Qty: <input type="text" class="qty" name="qty" style="width: 50px;">
                 Item: <input type="text" class="item" name="item">
                 <button class="deleteing" name="del"><i class="fa fa-trash-o"></i></button><br>
             </div>
         </div> 


        <h1> Edit Cart </h1>

        <form action="/myrecipes/{{ userid }}/cart/{{ session['Cart'] }}/edit-confirm" method="POST" id="edit-ingredient-form">

            <div id="ingredient-section">
                <h3> Cart Items </h3>

                <div class="ingredient-field">
                {% for c in cart_ings %}
                    {% if c.ingredient.measure == '' and c.ingredient.quantity != '' %}
                      <div class="{{ loop.index }}">

                          <!-- Ingredient Quantity -->
                          <span> Qty: </span>
                          <input type="text" class="qty" name="qty{{ loop.index }}" value="{{ c.ingredient.quantity }}" style="width: 50px;">

                          <!-- Ingredient Item -->
                          <span> Item: </span>
                          <input type="text" class="item" name="item{{ loop.index }}" value="{{ c.ingredient.item }}">
                          
                          <!-- Delete Ingredient -->
                          <button class="deleteing" name="del{{ loop.index }}">
                            <i class="fa fa-trash-o"></i>
                          </button><br>

                        </div> <!-- loop index div -->
                    {% else %}
                      <div class="{{ loop.index }}">

                        <!-- Ingredient Quantity -->
                        <span> Qty: </span>
                        <input type="text" class="qty" name="qty{{ loop.index }}" style="width: 50px;">

                        <!-- Ingredient Item -->
                        <span> Item: </span>
                        <input type="text" class="item" name="item{{ loop.index }}" value="{{ c.ingredient.item }}">
                        
                        <!-- Delete Ingredient -->
                        <button class="deleteing" name="del{{ loop.index }}">
                          <i class="fa fa-trash-o"></i>
                        </button><br>

                    </div> <!-- loop index div -->
                    {% endif %}
                {% endfor %}
              </div> <!-- div for ingredient-field -->

            </div> <!-- div for #ingredient-section -->


            <button type="button" id="add-more">+ Add another ingredient</button><br>
            <p id="cart-ingredient-msg" hidden>
              You can't add any more ingredients to your cart. Baby steps.
            </p>

            
            <!-- Submit edited form -->
            <input type="submit" class="confirmcart" value="Submit Cart Changes">
        </form>
    {% endif %}
{% else %}
        <h1>You can't edit this recipe!!</h1>
{% endif %}
{% endblock %}

{% block script %}
  <script>

  $(".deleteing").on('click', function(evt) {
    evt.preventDefault();
    //finds the index the ingredient to be delete
    //removes all fields that have a class of that index
    delIng = $(this).attr('name');

    $("div").each(function() {
      console.log(this);
      if ($(this).hasClass(delIng)) {
        this.remove();
      }

    });

  });

    $("#add-more").on('click', function() {
       // allows user to add more ingredients to recipe


        var new_ingredient_field = $("#template-input").clone();
        new_ingredient_field.removeAttr('id').removeAttr('style');
        new_ingredient_field.appendTo("#ingredient-section");

        //finds the integer of the last ingredient, and adds 1
        latestIngredient = $(".ingredient-field").children().last().attr('class');
        index = parseInt(latestIngredient) + 1;


       // this allows us make unique names for different ingredients
       $('.qty', new_ingredient_field).attr('name', 'qty' + index); 
       $('.item', new_ingredient_field).attr('name', 'item' + index); 
       $('.deleteing'), new_ingredient_field.attr('name', 'del' + index);

       //limits the length of the cart
       if (index >= 50) {
           $("#add-more").prop('disabled', true);
           $("#cart-ingredient-msg").show();
       }

    });

  </script>

{% endblock %}